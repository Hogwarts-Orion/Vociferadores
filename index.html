<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Profeta - Edici√≥n Legendaria Orion</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Special+Elite&family=Old+Standard+TT:ital,wght@0,400;0,700;1,400&display=swap');

        :root {
            --pergamino: #e4d5b7; --pergamino-osc: #d4c4a5;
            --tinta: #1a1a1a; --oro: #b08d57; --oro-bril: #ffd700;
            --sangre: #8b0000; --sombra: rgba(0,0,0,0.2);
        }

        body {
            margin: 0; background: #0a0a0a url('https://www.transparenttextures.com/patterns/dark-leather.png');
            color: var(--tinta); font-family: 'Old Standard TT', serif;
            display: flex; justify-content: center; padding: 10px;
        }

        /* --- CUERPO DEL PERI√ìDICO --- */
        .newspaper {
            background: var(--pergamino) url('https://www.transparenttextures.com/patterns/paper-fibers.png');
            width: 100%; max-width: 700px; min-height: 100vh;
            padding: 35px; box-sizing: border-box;
            border: 1px solid #000; box-shadow: 0 0 60px rgba(0,0,0,1);
            position: relative; border-radius: 2px;
        }

        .newspaper::after { /* Efecto de borde quemado */
            content: ""; position: absolute; top:0; left:0; right:0; bottom:0;
            pointer-events: none; border: 20px solid transparent;
            border-image: url('https://www.transparenttextures.com/patterns/pinstriped-suit.png') 30 round;
            opacity: 0.1;
        }

        /* --- CABECERA MAJESTUOSA --- */
        header { text-align: center; border-bottom: 10px double var(--tinta); margin-bottom: 20px; }
        header h1 { 
            font-family: 'Cinzel', serif; font-size: clamp(50px, 15vw, 85px); 
            margin: 0; font-weight: 900; letter-spacing: -3px; line-height: 0.9;
        }
        
        .meta-bar {
            display: flex; justify-content: space-between; border-top: 3px solid #000;
            padding: 8px 0; font-weight: 700; font-size: 12px; text-transform: uppercase;
            font-family: 'Cinzel';
        }

        /* --- NOTICIAS EN VIVO --- */
        .ticker-wrap {
            background: var(--tinta); color: var(--pergamino);
            padding: 10px; margin-bottom: 30px; border-radius: 3px;
            box-shadow: inset 0 0 10px #000; overflow: hidden;
        }
        #ticker { font-family: 'Special Elite'; font-size: 13px; text-align: center; animation: fadeNews 1s; }
        @keyframes fadeNews { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- SECCIONES DIFERENCIADAS --- */
        .sec-header {
            font-family: 'Cinzel'; background: var(--tinta); color: var(--oro);
            text-align: center; padding: 10px; letter-spacing: 5px; font-size: 16px;
            margin: 50px 0 30px 0; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* CR√ìNICA REAL: Estilo Antiguo de lujo */
        .card-oficial {
            border: 2px solid var(--oro); padding: 30px; margin-bottom: 40px;
            background: rgba(255,255,255,0.3); position: relative;
            box-shadow: 10px 10px 0px var(--oro);
        }
        .card-oficial h3 { font-size: 32px; text-decoration: underline; text-decoration-color: var(--oro); }

        /* CHISME ALUMNO: Estilo recorte suelto */
        .card-alumno {
            border-bottom: 1px dashed #555; padding: 20px 0; margin-bottom: 30px;
            display: grid; grid-template-columns: 1fr; gap: 15px;
        }

        .article h3 { font-family: 'Cinzel'; margin: 0; line-height: 1; }
        .article img { 
            width: 100%; border: 5px solid var(--tinta); margin: 15px 0;
            filter: grayscale(1) sepia(0.3) contrast(1.2); transition: 0.5s;
        }
        .article img:hover { filter: grayscale(0) sepia(0); }
        .article p { font-size: 18px; line-height: 1.4; text-align: justify; }

        /* --- FAMA M√ÅGICA --- */
        .famoso { color: var(--oro) !important; text-shadow: 0 0 8px var(--oro-bril); font-weight: 900; }

        /* --- VOCIFERADORA --- */
        .vociferadora {
            background: #fff5f5 !important; border: 3px solid var(--sangre) !important;
            animation: tremor 0.2s infinite; box-shadow: 0 0 30px rgba(139,0,0,0.3) !important;
        }
        .vociferadora h3, .vociferadora p { color: var(--sangre) !important; }

        @keyframes tremor { 0% { transform: translate(1px, 1px) rotate(0.5deg); } 100% { transform: translate(-1px, -1px) rotate(-0.5deg); } }

        /* --- FORMULARIO MAGN√çFICO --- */
        .magic-form {
            background: var(--pergamino-osc); border: 2px solid var(--tinta);
            padding: 30px; margin-top: 60px; box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }
        input, textarea, select {
            width: 100%; padding: 15px; margin: 12px 0; border: 1px solid #000;
            background: rgba(255,255,255,0.5); font-family: 'Special Elite'; font-size: 16px;
        }
        .btn-main {
            background: var(--tinta); color: var(--pergamino); border: none;
            padding: 20px; width: 100%; font-family: 'Cinzel'; font-size: 20px;
            font-weight: 900; cursor: pointer; transition: 0.3s;
        }
        .btn-main:hover { background: #333; letter-spacing: 2px; }

        .voto-btn {
            background: none; border: 2px solid var(--tinta); padding: 8px 15px;
            font-family: 'Cinzel'; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .voto-btn:hover:not(:disabled) { background: var(--tinta); color: var(--pergamino); }
    </style>
</head>
<body>

<div class="newspaper">
    <div id="login-zone" style="text-align:center; padding: 80px 0;">
        <h1 style="font-family:'Cinzel'; font-size: 50px;">ACCESO RESTRINGIDO</h1>
        <p style="letter-spacing: 2px;">DEPARTAMENTO DE SEGURIDAD M√ÅGICA</p>
        <div style="max-width:300px; margin: 0 auto;">
            <input type="text" id="u-name" placeholder="Nombre de Mago">
            <input type="password" id="u-pass" placeholder="Contrase√±a">
            <select id="u-house">
                <option value="GRYFFINDOR">ü¶Å GRYFFINDOR</option>
                <option value="SLYTHERIN">üêç SLYTHERIN</option>
                <option value="HUFFLEPUFF">ü¶° HUFFLEPUFF</option>
                <option value="RAVENCLAW">ü¶Ö RAVENCLAW</option>
            </select>
            <button class="btn-main" onclick="validar()">ENTRAR ‚ú®</button>
        </div>
    </div>

    <div id="prophet-web" style="display:none;">
        <header>
            <h1>EL PROFETA</h1>
            <div class="meta-bar">
                <span id="txt-fecha"></span>
                <span id="txt-reloj"></span>
                <span onclick="logout()" style="cursor:pointer; color:var(--sangre)">[ CERRAR ]</span>
            </div>
        </header>

        <div class="ticker-wrap"><div id="ticker">Cargando noticias v√≠a red de flu...</div></div>

        <div id="sec-oficial"></div>
        <div id="sec-alumnos"></div>

        <div class="sec-header">üñãÔ∏è NUEVA CORRESPONDENCIA</div>
        <div class="magic-form">
            <input type="text" id="in-tit" placeholder="Titular de la noticia">
            <textarea id="in-msg" rows="5" placeholder="Relata los hechos con detalle..."></textarea>
            <input type="text" id="in-img" placeholder="Link de la imagen (GIF o Foto)">
            <div style="display:flex; gap:15px;">
                <select id="in-ran">
                    <option value="ALUMNO">Alumno</option>
                    <option value="OFICIAL">Escritor Orion</option>
                </select>
                <select id="in-est">
                    <option value="normal">Pergamino Normal</option>
                    <option value="vociferadora">Vociferadora üî•</option>
                </select>
            </div>
            <button class="btn-main" onclick="postear()">ENVIAR LECHUZA ‚ú®</button>
        </div>
    </div>
</div>

<audio id="snd-magic" src="https://assets.mixkit.co/active_storage/sfx/2014/2014-preview.mp3"></audio>

<script>
    const DB_PATH = "https://profeta-9c8df-default-rtdb.firebaseio.com/periodico";
    const KEY_OFICIAL = "Orion2026";
    let user = JSON.parse(localStorage.getItem('user_profeta_final'));

    const HEADLINES = [
        "ü¶â LA LECHUCER√çA REPORTA EXCESO DE TRABAJO ESTE MES.",
        "‚ú® EL PROFESOR DE POCIONES BUSCA INGREDIENTES RAROS EN EL BOSQUE.",
        "üßπ ¬øNUEVO MODELO DE ESCOBA? LA SAETA NEGRA APARECE EN EL MERCADO.",
        "ü¶Å GRYFFINDOR LIDERA LA COPA DE LAS CASAS POR AHORA.",
        "üß™ SE FILTRA LA F√ìRMULA DE LA POCI√ìN MULTIJUGOS EN EL BA√ëO.",
        "üé≠ EL BAILE DE INVIERNO PODR√çA ADELANTARSE, DICE EL DIRECTOR."
    ];

    function updateNews() {
        const t = document.getElementById('ticker');
        if(t) t.innerText = HEADLINES[Math.floor(Math.random() * HEADLINES.length)];
    }
    setInterval(updateNews, 6000);

    function clock() {
        const d = new Date();
        const r = document.getElementById('txt-reloj');
        if(r) r.innerText = d.toLocaleTimeString('es-ES');
    }
    setInterval(clock, 1000);

    function validar() {
        const u = document.getElementById('u-name').value.trim();
        const p = document.getElementById('u-pass').value.trim();
        const h = document.getElementById('u-house').value;
        if(!u || !p) return;
        user = { u, h };
        localStorage.setItem('user_profeta_final', JSON.stringify(user));
        document.getElementById('snd-magic').play();
        start();
    }

    function logout() { localStorage.removeItem('user_profeta_final'); location.reload(); }

    function start() {
        if(!user) return;
        document.getElementById('login-zone').style.display = 'none';
        document.getElementById('prophet-web').style.display = 'block';
        document.getElementById('txt-fecha').innerText = new Date().toLocaleDateString('es-ES', {weekday:'long', day:'numeric', month:'long'}).toUpperCase();
        load();
    }

    function postear() {
        const t = document.getElementById('in-tit').value.trim();
        const m = document.getElementById('in-msg').value.trim();
        const r = document.getElementById('in-ran').value;
        if(!t || !m) return;
        if(r === "OFICIAL" && prompt("Contrase√±a Real:") !== KEY_OFICIAL) return;

        const id = "ID_" + Date.now();
        const data = {
            id, titulo: t, texto: m, img: document.getElementById('in-img').value,
            rango: r, estilo: document.getElementById('in-est').value,
            autor: user.u, casa: user.h, v_list: {}, votos: 0, time: Date.now()
        };
        fetch(`${DB_PATH}/${id}.json`, { method: 'PUT', body: JSON.stringify(data) }).then(() => location.reload());
    }

    function load() {
        fetch(`${DB_PATH}.json`).then(r => r.json()).then(data => {
            if(!data) return;
            const items = Object.values(data).sort((a,b) => b.time - a.time);
            let ofHTML = ""; let alHTML = "";

            items.forEach(n => {
                const voted = n.v_list && n.v_list[user.u];
                const esFamoso = (n.votos || 0) >= 5;
                const cardType = n.rango === "OFICIAL" ? "card-oficial" : "card-alumno";
                const vocal = n.estilo === 'vociferadora' ? 'vociferadora' : '';
                
                const html = `
                    <div class="article ${cardType} ${vocal}">
                        <h3>${n.titulo}</h3>
                        <small>POR: <span class="${esFamoso ? 'famoso' : ''}">${n.autor}</span> (${n.casa})</small>
                        ${n.img ? `<img src="${n.img}">` : ''}
                        <p>${n.texto}</p>
                        <div style="text-align:right;">
                            <button class="voto-btn" onclick="votar('${n.id}')" ${voted ? 'disabled' : ''}>
                                ${voted ? '‚ú® SELLADO' : 'üî• GRITAR ('+(n.votos || 0)+')'}
                            </button>
                        </div>
                    </div>
                `;
                if(n.rango === "OFICIAL") ofHTML += html; else alHTML += html;
            });

            document.getElementById('sec-oficial').innerHTML = ofHTML ? `<div class="sec-header">DECRETOS DEL MINISTERIO</div>` + ofHTML : "";
            document.getElementById('sec-alumnos').innerHTML = `<div class="sec-header">NOTICIAS DE LA COMUNIDAD</div>` + alHTML;
        });
    }

    async function votar(id) {
        document.getElementById('snd-magic').play();
        await fetch(`${DB_PATH}/${id}/v_list/${user.u}.json`, { method: 'PUT', body: JSON.stringify(true) });
        const res = await fetch(`${DB_PATH}/${id}/votos.json`);
        const val = await res.json() || 0;
        await fetch(`${DB_PATH}/${id}/votos.json`, { method: 'PUT', body: JSON.stringify(val + 1) });
        load();
    }

    if(user) start();
</script>
</body>
</html>
