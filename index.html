<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Profeta Rebelde - Edici√≥n Pro</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Special+Elite&display=swap');

        :root {
            --oro: #c5a059; --sangre: #8b0000; --pergamino: #fdf5e6; --oscuro: #1a150f;
        }

        body {
            margin: 0; background: var(--oscuro); color: #2c1e11;
            font-family: 'Special Elite', cursive; display: flex; justify-content: center;
        }

        /* --- CONTENEDOR PRINCIPAL --- */
        .paper {
            background: var(--pergamino);
            width: 100%; max-width: 480px; min-height: 100vh;
            padding: 20px; box-sizing: border-box;
            border-left: 5px solid var(--oro); border-right: 5px solid var(--oro);
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        header { text-align: center; border-bottom: 3px solid var(--oscuro); margin-bottom: 20px; }
        header h1 { font-family: 'Cinzel', serif; font-size: 32px; margin: 10px 0; letter-spacing: -1px; }

        /* --- MARQUESINA DE NOTICIAS INVENTADAS --- */
        .marquee {
            background: #000; color: var(--oro); padding: 8px;
            font-family: 'Cinzel'; font-size: 11px; text-align: center;
            margin-bottom: 20px; border-radius: 4px; overflow: hidden;
        }

        /* --- TARJETAS DE NOTICIAS --- */
        .card {
            background: white; border: 1px solid #ddd; padding: 15px;
            margin-bottom: 20px; border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: 0.3s; position: relative;
        }

        .card h3 { font-family: 'Cinzel'; margin: 0 0 10px 0; color: var(--sangre); }
        .card img { width: 100%; border-radius: 5px; margin: 10px 0; }
        .card p { font-size: 14px; line-height: 1.5; margin: 5px 0; }
        
        .tag { font-size: 9px; padding: 3px 8px; border-radius: 4px; color: white; font-weight: bold; text-transform: uppercase; }
        .Slytherin { background: #1a472a; } .Gryffindor { background: #740001; }
        .Hufflepuff { background: #ecb939; color: black; } .Ravenclaw { background: #0e1a40; }
        .OFICIAL { background: var(--oro); color: black; }

        /* --- VOCIFERADORA --- */
        .vociferadora { border: 2px solid var(--sangre); animation: shake 0.3s infinite; background: #fff5f5; }
        @keyframes shake { 0% { transform: rotate(0.5deg); } 100% { transform: rotate(-0.5deg); } }

        /* --- FORMULARIO --- */
        .form-box {
            background: #f0f0f0; padding: 20px; border-radius: 12px;
            border: 2px solid var(--oro); margin-top: 30px;
        }
        input, textarea, select {
            width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc;
            border-radius: 6px; font-family: 'Special Elite'; box-sizing: border-box;
        }

        .btn {
            background: var(--oro); color: white; border: none; padding: 15px;
            width: 100%; font-family: 'Cinzel'; font-weight: bold; font-size: 18px;
            border-radius: 6px; cursor: pointer; margin-top: 10px;
        }

        /* --- PARTICULAS --- */
        .sparkle {
            position: absolute; width: 4px; height: 4px; background: var(--oro);
            border-radius: 50%; pointer-events: none; animation: pop 0.6s linear forwards;
        }
        @keyframes pop { 100% { transform: translate(var(--x), var(--y)); opacity: 0; } }
    </style>
</head>
<body onclick="spark(event)">

<div class="paper">
    <div id="login-screen" style="text-align: center; padding-top: 50px;">
        <h1 style="font-family:'Cinzel'">EL PROFETA</h1>
        <p>Inicia sesi√≥n para leer y publicar</p>
        <input type="text" id="login-name" placeholder="Tu Nombre M√°gico">
        <select id="login-house">
            <option value="Gryffindor">Gryffindor ü¶Å</option>
            <option value="Slytherin">Slytherin üêç</option>
            <option value="Hufflepuff">Hufflepuff ü¶°</option>
            <option value="Ravenclaw">Ravenclaw ü¶Ö</option>
        </select>
        <button class="btn" onclick="doLogin()">ENTRAR ‚ú®</button>
    </div>

    <div id="main-content" style="display:none;">
        <header>
            <h1>EL PROFETA REBELDE</h1>
            <div id="user-info" style="font-size: 10px; color: #666; padding-bottom: 5px;"></div>
        </header>

        <div class="marquee" id="news-flash">üì¢ Cargando noticias del Ministerio...</div>

        <div id="feed"></div>

        <div class="form-box">
            <h3 style="text-align:center; font-family:'Cinzel'; margin:0;">üñãÔ∏è NUEVA NOTICIA</h3>
            <input type="text" id="post-tit" placeholder="T√≠tulo">
            <textarea id="post-msg" rows="3" placeholder="Contenido..."></textarea>
            <input type="text" id="post-img" placeholder="URL de imagen (opcional)">
            <select id="post-type">
                <option value="normal">Estilo Normal</option>
                <option value="vociferadora">Vociferadora üî•</option>
            </select>
            <button class="btn" onclick="sendPost()">PUBLICAR ‚ú®</button>
            <button onclick="logout()" style="background:none; border:none; color:grey; font-size:10px; width:100%; margin-top:10px;">Cerrar Sesi√≥n</button>
        </div>
    </div>
</div>

<audio id="sound-magic" src="https://assets.mixkit.co/active_storage/sfx/2014/2014-preview.mp3"></audio>

<script>
    const DB = "https://profeta-9c8df-default-rtdb.firebaseio.com/periodico";
    let user = JSON.parse(localStorage.getItem('mago_user'));
    let myVotes = JSON.parse(localStorage.getItem('votos_db')) || [];

    const NEWS = [
        "üì¢ √öLTIMA HORA: Gringotts reporta una brecha en la b√≥veda 713.",
        "üóûÔ∏è RUMOR: ¬øVuelve el Torneo de los Tres Magos este a√±o?",
        "ü¶â AVISO: Retrasos en el correo por tormenta de nieve m√°gica.",
        "üêæ CRIATURAS: Un Escarbato suelto en el Ministerio de Magia.",
        "ü™Ñ MODA: Las t√∫nicas de terciopelo son tendencia en Hogsmeade."
    ];

    setInterval(() => {
        document.getElementById('news-flash').innerText = NEWS[Math.floor(Math.random()*NEWS.length)];
    }, 5000);

    function spark(e) {
        for(let i=0; i<5; i++){
            let s = document.createElement('div');
            s.className = 'sparkle';
            s.style.left = e.pageX+'px'; s.style.top = e.pageY+'px';
            s.style.setProperty('--x', (Math.random()*60-30)+'px');
            s.style.setProperty('--y', (Math.random()*60-30)+'px');
            document.body.appendChild(s);
            setTimeout(() => s.remove(), 600);
        }
    }

    function doLogin() {
        const n = document.getElementById('login-name').value;
        const h = document.getElementById('login-house').value;
        if(!n) return alert("Escribe tu nombre");
        user = { n, h };
        localStorage.setItem('mago_user', JSON.stringify(user));
        document.getElementById('sound-magic').play();
        showWeb();
    }

    function logout() { localStorage.removeItem('mago_user'); location.reload(); }

    function showWeb() {
        if(!user) return;
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        document.getElementById('user-info').innerText = `Mago: ${user.n} | ${user.h}`;
        loadPosts();
    }

    function sendPost() {
        const t = document.getElementById('post-tit').value;
        const m = document.getElementById('post-msg').value;
        const img = document.getElementById('post-img').value;
        const sty = document.getElementById('post-type').value;

        if(!t || !m) return alert("Completa los campos");

        document.getElementById('sound-magic').play();
        const id = "P" + Date.now();
        const data = { id, titulo: t, texto: m, img, estilo: sty, autor: user.n, casa: user.h, votos: 0 };

        fetch(`${DB}/${id}.json`, { method: 'PUT', body: JSON.stringify(data) }).then(() => location.reload());
    }

    function loadPosts() {
        fetch(`${DB}.json`).then(r => r.json()).then(data => {
            if(!data) return;
            const posts = Object.values(data).reverse();
            document.getElementById('feed').innerHTML = posts.map(p => {
                const voted = myVotes.includes(p.id);
                return `
                <div class="card ${p.estilo === 'vociferadora' ? 'vociferadora' : ''}">
                    <span class="tag ${p.casa}">${p.casa || 'General'}</span>
                    <h3>${p.titulo}</h3>
                    ${p.img ? `<img src="${p.img}">` : ''}
                    <p>${p.texto}</p>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <small>üñäÔ∏è ${p.autor}</small>
                        <button onclick="vote('${p.id}', ${p.votos || 0})" 
                            style="border:1px solid var(--oro); background:none; cursor:pointer;"
                            ${voted ? 'disabled' : ''}>
                            ${voted ? '‚úÖ' : 'üî• ' + (p.votos || 0)}
                        </button>
                    </div>
                </div>`;
            }).join('');
        });
    }

    async function vote(id, v) {
        if(myVotes.includes(id)) return;
        myVotes.push(id);
        localStorage.setItem('votos_db', JSON.stringify(myVotes));
        document.getElementById('sound-magic').play();
        await fetch(`${DB}/${id}/votos.json`, { method: 'PUT', body: JSON.stringify(v + 1) });
        loadPosts();
    }

    if(user) showWeb();
</script>
</body>
</html>
