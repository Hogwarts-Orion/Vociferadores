<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Profeta Rebelde - Ultra M√°gico</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Special+Elite&display=swap');

        :root {
            --oro: #c5a059; --oro-brillante: #d4af37; --sangre: #8b0000;
            --pergamino: #f4e4bc; --oscuro: #1a150f;
        }

        body {
            margin: 0; background: var(--oscuro);
            color: #2c1e11; font-family: 'Special Elite', cursive;
            display: flex; justify-content: center; overflow-x: hidden;
            touch-action: manipulation;
        }

        /* --- EFECTO DE CHISPAS --- */
        .sparkle {
            position: absolute; width: 6px; height: 6px; background: var(--oro-brillante);
            border-radius: 50%; pointer-events: none; z-index: 9999;
            animation: fly 0.8s ease-out forwards;
        }
        @keyframes fly {
            0% { transform: translate(0,0) scale(1); opacity: 1; }
            100% { transform: translate(var(--x), var(--y)) scale(0); opacity: 0; }
        }

        .paper {
            background: var(--pergamino) url('https://www.transparenttextures.com/patterns/paper-fibers.png');
            width: 100%; max-width: 500px; padding: 25px;
            box-shadow: 0 0 50px rgba(0,0,0,0.9); border: 8px double #8b6d45;
            box-sizing: border-box; min-height: 100vh; position: relative;
        }

        /* Flash M√°gico */
        .flash-effect {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: white; opacity:0; pointer-events:none; z-index:10000;
        }

        header h1 { font-family: 'Cinzel', serif; font-size: 35px; text-align: center; margin: 10px 0; }

        /* Estilo Vociferadora Mejorado */
        .vociferadora {
            border: 3px solid var(--sangre) !important;
            background: #fff0f0 !important;
            animation: scream 0.2s infinite;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.4) !important;
        }
        @keyframes scream {
            0% { transform: rotate(0.5deg) scale(1.01); }
            100% { transform: rotate(-0.5deg) scale(1); }
        }

        .btn-magico {
            background: var(--oro-brillante); color: black; border: none;
            padding: 15px; width: 100%; font-family: 'Cinzel'; font-weight: 900;
            font-size: 20px; cursor: pointer; border-radius: 5px; margin-top: 10px;
            transition: 0.2s; box-shadow: 0 4px 0 #8b6d45;
        }
        .btn-magico:active { transform: translateY(4px); box-shadow: none; }

        .noticia-card {
            background: white; padding: 15px; margin-bottom: 20px;
            border: 1px solid #ccc; position: relative; transition: 0.5s;
        }

        #btn-sonido {
            position: fixed; bottom: 10px; right: 10px; z-index: 1000;
            background: var(--sangre); color: white; border: none; border-radius: 50%;
            width: 40px; height: 40px; cursor: pointer; font-size: 20px;
        }
    </style>
</head>
<body onclick="crearChispas(event)">

    <div class="flash-effect" id="flash"></div>
    <button id="btn-sonido" onclick="activarAudio()">üîà</button>

    <div class="paper">
        <div id="pantalla-login" style="text-align:center; padding-top:40px;">
            <h1 style="font-family:'Cinzel'">IDENTIFICACI√ìN</h1>
            <input type="text" id="u-name" placeholder="Tu Nombre..." style="width:80%; padding:15px; margin:10px; border:2px solid var(--oro);">
            <select id="u-house" style="width:87%; padding:15px; border:2px solid var(--oro);">
                <option value="Gryffindor">Gryffindor ü¶Å</option>
                <option value="Slytherin">Slytherin üêç</option>
                <option value="Hufflepuff">Hufflepuff ü¶°</option>
                <option value="Ravenclaw">Ravenclaw ü¶Ö</option>
            </select>
            <button class="btn-magico" onclick="login()">ENTRAR ‚ú®</button>
        </div>

        <div id="web" style="display:none;">
            <header>
                <h1 id="titulo-web">EL PROFETA</h1>
                <p id="user-info" style="text-align:center; font-size:12px; margin:0;"></p>
            </header>

            <div id="lista"></div>

            <div style="background:var(--oscuro); padding:20px; border-radius:10px; margin-top:30px; color:var(--pergamino);">
                <h3 style="text-align:center; font-family:'Cinzel'; color:var(--oro);">üñãÔ∏è REDACTAR</h3>
                <input type="text" id="p-tit" placeholder="T√≠tulo...">
                <textarea id="p-txt" rows="4" placeholder="Contenido..."></textarea>
                <select id="p-est">
                    <option value="normal">Estilo Normal</option>
                    <option value="vociferadora">Vociferadora üî•</option>
                </select>
                <button class="btn-magico" onclick="publicar()">LANZAR HECHIZO ‚ú®</button>
            </div>
        </div>
    </div>

    <audio id="snd-click" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>
    <audio id="snd-magic" src="https://assets.mixkit.co/active_storage/sfx/2014/2014-preview.mp3"></audio>
    <audio id="snd-write" src="https://www.soundjay.com/misc/sounds/writing-on-paper-1.mp3"></audio>

    <script>
        const DB = "https://profeta-9c8df-default-rtdb.firebaseio.com/periodico";
        let mago = JSON.parse(localStorage.getItem('mago_final'));
        let audioActivo = false;

        function activarAudio() {
            audioActivo = true;
            document.getElementById('btn-sonido').innerText = "üîä";
            document.getElementById('snd-magic').play();
            alert("¬°Magia activada! Ya puedes escuchar los efectos.");
        }

        function crearChispas(e) {
            if(audioActivo) document.getElementById('snd-click').cloneNode(true).play();
            for(let i=0; i<8; i++) {
                const s = document.createElement('div');
                s.className = 'sparkle';
                s.style.left = e.pageX + 'px';
                s.style.top = e.pageY + 'px';
                s.style.setProperty('--x', (Math.random()*100 - 50)+'px');
                s.style.setProperty('--y', (Math.random()*100 - 50)+'px');
                document.body.appendChild(s);
                setTimeout(() => s.remove(), 800);
            }
        }

        function login() {
            const n = document.getElementById('u-name').value;
            const c = document.getElementById('u-house').value;
            if(!n) return;
            mago = { n, c };
            localStorage.setItem('mago_final', JSON.stringify(mago));
            if(audioActivo) document.getElementById('snd-magic').play();
            mostrar();
        }

        function mostrar() {
            if(!mago) return;
            document.getElementById('pantalla-login').style.display = 'none';
            document.getElementById('web').style.display = 'block';
            document.getElementById('user-info').innerText = `${mago.n} de ${mago.c}`;
            cargar();
        }

        function publicar() {
            const t = document.getElementById('p-tit').value;
            const tx = document.getElementById('p-txt').value;
            const es = document.getElementById('p-est').value;

            if(!t || !tx) return;

            // Efecto Flash
            document.getElementById('flash').style.opacity = "1";
            setTimeout(() => document.getElementById('flash').style.opacity = "0", 300);

            if(audioActivo) document.getElementById('snd-write').play();
            if(es === 'vociferadora' && navigator.vibrate) navigator.vibrate([200, 100, 200]);

            const id = "ID_" + Date.now();
            const data = { id, titulo: t, texto: tx, estilo: es, autor: mago.n, casa: mago.c, votos: 0 };

            fetch(`${DB}/${id}.json`, { method: 'PUT', body: JSON.stringify(data) }).then(() => location.reload());
        }

        function cargar() {
            fetch(`${DB}.json`).then(r => r.json()).then(data => {
                if(!data) return;
                const notas = Object.values(data).reverse();
                document.getElementById('lista').innerHTML = notas.map(n => `
                    <div class="noticia-card ${n.estilo === 'vociferadora' ? 'vociferadora' : ''}">
                        <small style="color:var(--oro)">${n.casa}</small>
                        <h3 style="margin:5px 0;">${n.titulo}</h3>
                        <p>${n.texto}</p>
                        <small>üñäÔ∏è ${n.autor}</small>
                    </div>
                `).join('');
            });
        }

        if(mago) mostrar();
    </script>
</body>
</html>
