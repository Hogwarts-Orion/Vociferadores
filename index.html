<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Profeta Rebelde - Edici√≥n Reliquia</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Special+Elite&family=MedievalSharp&display=swap');

        :root {
            --oro: #c5a059; --oro-brillante: #d4af37; --sangre: #8b0000;
            --pergamino: #f4e4bc; --oscuro: #1a150f;
        }

        * { cursor: url('https://cur.cursors-4u.net/others/oth-8/oth726.cur'), auto !important; }

        body {
            margin: 0; background: var(--oscuro) url('https://www.transparenttextures.com/patterns/dark-matter.png');
            color: #2c1e11; font-family: 'Special Elite', cursive;
            display: flex; justify-content: center; padding: 10px; overflow-x: hidden;
        }

        /* --- CONTENEDOR M√ÅGICO --- */
        .paper {
            background: var(--pergamino) url('https://www.transparenttextures.com/patterns/paper-fibers.png');
            width: 100%; max-width: 550px; padding: 25px;
            box-shadow: 0 0 50px rgba(0,0,0,0.9), inset 0 0 100px rgba(139, 109, 69, 0.2);
            border: 10px double #8b6d45; box-sizing: border-box; min-height: 100vh;
            position: relative; overflow: hidden;
        }

        /* --- LOGIN Y REGISTRO --- */
        #pantalla-login { text-align: center; padding: 40px 10px; }
        .login-card { background: rgba(0,0,0,0.05); padding: 20px; border: 2px dashed var(--oro); border-radius: 10px; }
        
        /* --- CABECERA --- */
        header { text-align: center; border-bottom: 8px double var(--oscuro); margin-bottom: 25px; position: relative; }
        header h1 { font-family: 'Cinzel', serif; font-size: clamp(30px, 9vw, 50px); margin: 5px 0; text-shadow: 1px 1px 0px var(--oro); }
        .user-badge { font-size: 11px; background: var(--oscuro); color: var(--oro); padding: 5px 12px; border-radius: 20px; font-family: 'Cinzel'; }

        /* --- NOTICIAS --- */
        .noticia-card {
            background: white; padding: 20px; margin-bottom: 25px; border-radius: 2px;
            border: 1px solid rgba(0,0,0,0.1); box-shadow: 6px 6px 0px rgba(0,0,0,0.1);
            position: relative; transition: 0.3s; transform: rotate(-0.5deg);
        }
        .noticia-card:nth-child(even) { transform: rotate(0.5deg); }

        .vociferadora {
            border: 3px solid var(--sangre) !important; background: #fff5f5 !important;
            box-shadow: 0 0 15px var(--sangre); animation: tremor 0.2s infinite;
        }
        @keyframes tremor { 0% { transform: scale(1.01) rotate(0.5deg); } 100% { transform: scale(1) rotate(-0.5deg); } }

        /* --- ELEMENTOS DE FORMULARIO --- */
        .box-envio {
            background: var(--oscuro); color: var(--pergamino); padding: 25px;
            border-radius: 15px; border: 3px solid var(--oro); margin-top: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        input, textarea, select {
            width: 100%; padding: 12px; margin: 8px 0; border: 2px solid var(--oro);
            background: #fffdf5; font-family: 'Special Elite'; font-size: 15px; border-radius: 5px;
        }

        .btn-magico {
            background: var(--oro-brillante); color: #000; border: none; padding: 18px;
            width: 100%; font-family: 'Cinzel'; font-weight: 900; font-size: 20px;
            cursor: pointer; transition: 0.3s; border-radius: 5px; margin-top: 10px;
        }
        .btn-magico:hover { background: white; box-shadow: 0 0 20px var(--oro-brillante); }

        .voto-btn {
            background: none; border: 2px solid var(--sangre); color: var(--sangre);
            width: 100%; padding: 10px; font-weight: bold; margin-top: 15px; 
            font-family: 'Cinzel'; cursor: pointer; border-radius: 5px;
        }
        .voto-btn.voted { background: var(--sangre); color: white; cursor: not-allowed; }

        /* --- TAGS --- */
        .tag { font-size: 10px; padding: 3px 8px; color: white; border-radius: 3px; font-weight: bold; text-transform: uppercase; }
        .Gryffindor { background: #740001; } .Slytherin { background: #1a472a; }
        .Hufflepuff { background: #ecb939; color: black; } .Ravenclaw { background: #0e1a40; }
        .OFICIAL { background: var(--oro); color: black; }

        /* --- EFECTO DE TINTA --- */
        .old-news { opacity: 0.7; filter: grayscale(0.3); }

        #logout-btn { background: none; border: 1px solid var(--sangre); color: var(--sangre); font-size: 10px; cursor: pointer; padding: 2px 5px; }
    </style>
</head>
<body>

    <div class="paper">
        <div id="pantalla-login">
            <img src="https://i.ibb.co/vzVf9yX/profeta-logo.png" style="width: 80px; filter: drop-shadow(0 0 10px var(--oro));">
            <h1 style="font-family: 'Cinzel'; margin-top: 10px;">IDENTIF√çCATE</h1>
            <div class="login-card">
                <input type="text" id="user-name" placeholder="Tu Apodo M√°gico..." maxlength="15">
                <select id="user-house">
                    <option value="Gryffindor">Gryffindor ü¶Å</option>
                    <option value="Slytherin">Slytherin üêç</option>
                    <option value="Hufflepuff">Hufflepuff ü¶°</option>
                    <option value="Ravenclaw">Ravenclaw ü¶Ö</option>
                </select>
                <button class="btn-magico" onclick="iniciarSesion()">FIRMAR REGISTRO ‚ú®</button>
            </div>
        </div>

        <div id="interfaz-web" style="display:none;">
            <header>
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <span class="user-badge" id="display-user"></span>
                    <button id="logout-btn" onclick="cerrarSesion()">CERRAR SESI√ìN</button>
                </div>
                <h1>EL PROFETA REBELDE</h1>
                <div style="font-size:11px; font-weight:bold; border-top:1px solid #000; padding:5px;">
                    <span id="fecha-actual"></span> | ‚ö° ORI√ìN
                </div>
            </header>

            <div id="lista-oficial"></div>
            <div id="lista-chismes"></div>

            <div class="box-envio">
                <h3 style="text-align:center; font-family:'Cinzel'; color:var(--oro); margin:0;">üñãÔ∏è REDACTAR PRIMICIA</h3>
                <input type="text" id="p-titulo" placeholder="T√≠tulo impactante...">
                <textarea id="p-texto" rows="4" placeholder="¬øQu√© esc√°ndalo has visto?"></textarea>
                <input type="text" id="p-img" placeholder="URL de Imagen o GIF (Opcional)">
                
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <select id="p-cat">
                        <option value="User">Mi Casa</option>
                        <option value="OFICIAL">üñãÔ∏è Rango: PROFETA</option>
                    </select>
                    <select id="p-estilo">
                        <option value="normal">Estilo: Normal</option>
                        <option value="vociferadora">Vociferadora üî•</option>
                    </select>
                </div>
                <div style="display:flex; align-items:center; gap:10px; margin: 10px 0;">
                    <label style="font-size:12px;">COLOR DE TINTA:</label>
                    <input type="color" id="p-color" value="#8b0000" style="width:40px; height:40px; border:none; background:none;">
                </div>
                <button class="btn-magico" onclick="crearPost()">LANZAR HECHIZO ‚ú®</button>
            </div>
        </div>
    </div>

    <audio id="snd-pluma" src="https://www.soundjay.com/misc/sounds/writing-on-paper-1.mp3"></audio>
    <audio id="snd-voto" src="https://www.myinstants.com/media/sounds/magic-spell.mp3"></audio>

    <script>
        const DB_URL = "https://profeta-9c8df-default-rtdb.firebaseio.com/periodico";
        const ADMIN_KEY = "Orion2026";
        
        let mago = JSON.parse(localStorage.getItem('mago_v3'));
        let misVotos = JSON.parse(localStorage.getItem('mis_votos_v3')) || [];

        function iniciarSesion() {
            const n = document.getElementById('user-name').value.trim();
            const c = document.getElementById('user-house').value;
            if(!n) return alert("Identif√≠cate o ser√°s enviado a Azkaban.");
            mago = { n, c };
            localStorage.setItem('mago_v3', JSON.stringify(mago));
            document.getElementById('snd-voto').play();
            mostrarWeb();
        }

        function cerrarSesion() {
            localStorage.removeItem('mago_v3');
            location.reload();
        }

        function mostrarWeb() {
            if(!mago) return;
            document.getElementById('pantalla-login').style.display = 'none';
            document.getElementById('interfaz-web').style.display = 'block';
            document.getElementById('display-user').innerText = `ü¶â ${mago.n} | ${mago.c}`;
            document.getElementById('fecha-actual').innerText = new Date().toLocaleDateString('es-ES', {weekday:'long', day:'numeric', month:'short'}).toUpperCase();
            cargar();
        }

        function crearPost() {
            const t = document.getElementById('p-titulo').value.trim();
            const tx = document.getElementById('p-texto').value.trim();
            const catSelect = document.getElementById('p-cat').value;
            const img = document.getElementById('p-img').value;
            const est = document.getElementById('p-estilo').value;
            const col = document.getElementById('p-color').value;

            if(!t || !tx) return alert("¬°Por las barbas de Merl√≠n! Escribe algo.");

            let catFinal = (catSelect === "OFICIAL") ? "OFICIAL" : mago.c;
            if(catSelect === "OFICIAL" && prompt("Llave:") !== ADMIN_KEY) return;

            document.getElementById('snd-pluma').play();
            const id = "ID_" + Date.now();
            const data = { id, titulo: t, texto: tx, img, estilo: est, color: col, cat: catFinal, autor: mago.n, votos: 0, time: Date.now() };

            fetch(`${DB_URL}/${id}.json`, { method: 'PUT', body: JSON.stringify(data) }).then(() => {
                location.reload();
            });
        }

        async function votar(id, actual) {
            if(misVotos.includes(id)) return;
            document.getElementById('snd-voto').play();
            misVotos.push(id);
            localStorage.setItem('mis_votos_v3', JSON.stringify(misVotos));
            await fetch(`${DB_URL}/${id}/votos.json`, { method: 'PUT', body: JSON.stringify(actual + 1) });
            cargar();
        }

        function cargar() {
            fetch(`${DB_URL}.json`).then(r => r.json()).then(data => {
                if(!data) return;
                const notas = Object.values(data).filter(n => n && n.id).sort((a,b) => b.time - a.time);
                
                const listOficial = [];
                const listChisme = [];

                notas.forEach((n, idx) => {
                    const yaVoto = misVotos.includes(n.id);
                    const isOld = idx > 10 ? 'old-news' : '';
                    const html = `
                        <div class="noticia-card ${n.estilo === 'vociferadora' ? 'vociferadora' : ''} ${isOld}" style="border-left: 8px solid ${n.color}">
                            <div style="display:flex; justify-content:space-between;">
                                <span class="tag ${n.cat}">${n.cat}</span>
                                <small style="font-size:9px; opacity:0.6;">${new Date(n.time).toLocaleTimeString()}</small>
                            </div>
                            <h3 style="color:${n.color}; font-family:'Cinzel'; margin:10px 0; font-size:22px;">${n.titulo}</h3>
                            ${n.img ? `<img src="${n.img}" style="width:100%; border:1px solid #ddd; margin-bottom:10px;">` : ''}
                            <p style="font-size:15px; line-height:1.5; color:#333;">${n.texto}</p>
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <small>üñäÔ∏è ${n.autor}</small>
                                <button class="voto-btn ${yaVoto ? 'voted' : ''}" onclick="votar('${n.id}', ${n.votos || 0})" ${yaVoto ? 'disabled' : ''}>
                                    ${yaVoto ? '‚úÖ REGISTRADO' : 'üî• ' + (n.votos || 0) + ' Gritos'}
                                </button>
                            </div>
                        </div>
                    `;
                    if(n.cat === "OFICIAL") listOficial.push(html);
                    else listChisme.push(html);
                });

                document.getElementById('lista-oficial').innerHTML = listOficial.length ? `<h2 style="font-family:'Cinzel'; color:var(--sangre); border-bottom:3px double #000;">üñãÔ∏è CR√ìNICAS REALES</h2>` + listOficial.join('') : '';
                document.getElementById('lista-chismes').innerHTML = `<h2 style="font-family:'Cinzel'; color:var(--sangre); border-bottom:3px double #000; margin-top:30px;">üî• EL CHISME VIVO</h2>` + listChisme.join('');
            });
        }

        if(mago) mostrarWeb();
    </script>
</body>
</html>
